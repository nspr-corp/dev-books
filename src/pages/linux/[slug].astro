---
import { getCollection } from 'astro:content';

import Layout from '@/layouts/Layout.astro';
import Main from '@/components/utils/Main.astro';
import MenuToggle from '@/components/utils/MenuToogle';

export async function getStaticPaths() {
    const entries = await getCollection('linux');
    return entries.map(entry => ({
        params: { slug: entry.slug },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { data } = entry;
const { Content } = await entry.render();

const allSections = await getCollection('linux');
const sortedSections = allSections.sort((a, b) => a.data.order - b.data.order);
---

<Layout title={data.title} description={data.description}>
    <Main>
        <div class="mx-auto max-w-screen-xl md:px-4">
            <div class="flex relative min-h-screen">
                <MenuToggle client:load>
                    <nav>
                        <h3 class="text-lg font-semibold mb-4">Secciones</h3>
                        <ul class="space-y-3">
                            {
                                sortedSections.map(section => (
                                    <li>
                                        <a
                                            href={`/linux/${section.slug}`}
                                            class={`block hover:text-blue-400 transition-colors ${
                                                entry.slug === section.slug
                                                    ? 'text-blue-500'
                                                    : 'text-gray-300'
                                            }`}
                                        >
                                            {section.data.isIntro
                                                ? 'Introducción'
                                                : section.data.title}
                                        </a>
                                    </li>
                                ))
                            }
                        </ul>
                    </nav>
                </MenuToggle>

                <div class="flex-1 min-w-0 px-4 md:px-8 pt-6">
                    <button
                        onclick="window.history.back()"
                        class="hover:underline opacity-70 cursor-pointer flex items-center gap-2 text-gray-400 hover:text-blue-400 transition-colors"
                    >
                        <span>←</span>
                        <span>Volver</span>
                    </button>
                    <h2 class="text-xl font-medium mt-2">
                        {data.title}
                    </h2>
                    <div
                        class="prose prose-invert
                        prose-p:text-base lg:prose-p:text-lg
                        prose-headings:text-3xl lg:prose-headings:text-4xl
                        prose-p:my-2
                        prose-h2:mt-14
                        prose-h2:mb-5
                        prose-p:leading-relaxed
                        max-w-none w-full"
                    >
                        <Content />
                    </div>
                </div>

                <div class="w-64 relative hidden lg:block">
                    <div class="sticky top-20 max-h-[calc(100vh-5rem)]">
                        {/* Contenido futuro */}
                    </div>
                </div>
            </div>
        </div>
    </Main>
</Layout>
