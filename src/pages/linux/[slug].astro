---
import { getCollection } from 'astro:content';

import Layout from '@/layouts/Layout.astro';
import Main from '@/components/utils/Main.astro';
import MenuToggle from '@/components/utils/MenuToogle';
import TableOfContents from '@/components/utils/TableOfContents';

export async function getStaticPaths() {
    const entries = await getCollection('linux');
    return entries.map(entry => ({
        params: { slug: entry.slug },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { data } = entry;
const { Content } = await entry.render();
const { headings } = await entry.render();
const h2 = headings.filter(heading => heading.depth === 2);

const allSections = await getCollection('linux');
const sortedSections = allSections.sort((a, b) => a.data.order - b.data.order);
---

<Layout title={data.title} description={data.description}>
    <Main>
        <div class="mx-auto max-w-screen-xl md:px-4 pb-16">
            <div
                class="grid grid-cols-[192px_minmax(0,1fr)_192px] relative min-h-screen gap-8"
            >
                <MenuToggle client:load>
                    <nav text-black>
                        <h4 class="text-lg font-semibold mb-4">Secciones</h4>
                        <ul class="space-y-3">
                            {
                                sortedSections.map(section => (
                                    <li>
                                        <a
                                            href={`/linux/${section.slug}`}
                                            class={`block hover:text-blue-400 transition-colors ${
                                                entry.slug === section.slug
                                                    ? 'text-blue-600 dark:text-blue-400 font-medium'
                                                    : 'dark:text-gray-300 text-black'
                                            }`}
                                        >
                                            {section.data.isIntro
                                                ? 'Introducción'
                                                : section.data.title}
                                        </a>
                                    </li>
                                ))
                            }
                        </ul>
                    </nav>
                </MenuToggle>

                <div class="flex-1 min-w-0 px-4 md:px-8 mt-4">
                    <button
                        onclick="window.history.back()"
                        class="hover:underline opacity-70 font-semibold cursor-pointer flex items-center gap-2 text-blue-500 dark:text-gray-400 hover:text-blue-400 transition-colors"
                    >
                        <span>←</span>
                        <span>Volver</span>
                    </button>
                    <h2 class="text-xl font-medium my-2 sticky top-0 text-black dark:text-gray-300">
                        {data.title}
                    </h2>
                    <div
                        class="prose
                        prose-invert
                        lg:prose-p:text-base
                        prose-p:text-base
                        prose-p:leading-relaxed
                        prose-p:text-black
                        prose-p:dark:text-gray-200
                        prose-p:mb-2
                        prose-p:mt-3
                        prose-h1:mb-6
                        prose-h1:text-black
                        prose-h1:dark:text-gray-200
                        prose-h2:text-black
                        prose-h2:dark:text-gray-200
                        prose-code:dark:text-white
                        prose-code:text-black
                        prose-ul:text-black
                        prose-table:text-black
                        prose-code:dark:bg-transparent
                        prose-pre:bg-red-500
                        prose-h2:mb-4
                        prose-h2:mt-0
                        prose-h2:mb-54
                        prose-h3:mt-4
                        prose-hr:my-6
                        prose-pre:my-4
                        max-w-none w-full"
                    >
                        <Content />
                    </div>
                </div>

                <div class="w-64 relative hidden lg:block h-full">
                    <TableOfContents client:load headings={h2} />
                </div>
            </div>
        </div>
    </Main>
</Layout>
